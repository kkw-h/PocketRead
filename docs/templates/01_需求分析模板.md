# 需求分析文档 (PRD)

**版本号**: 1.1
**作者**: 
**日期**: 

## 1. 简介
### 1.1 背景
[简述项目背景和立项原因]
### 1.2 目标
[列出核心目标]

## 2. 用户角色 (Personas)
| 角色 | 描述 | 关键需求 |
| :--- | :--- | :--- |
| 拥有者 (Owner) | 部署并使用自己的后端 | 数据私有、配置简单、多端同步 |

## 3. 功能需求 (Functional Requirements)
### 3.1 核心功能列表
| ID | 功能模块 | 功能点 | 优先级 | 描述 |
| :--- | :--- | :--- | :--- | :--- |
| F-01 | 服务端配置 | 连接自托管后端 | P0 | 输入 Worker URL 和 API Key |
| F-02 | 阅读同步 | 进度上传/下载 | P0 | 自动同步阅读位置，支持离线缓存 |
| F-03 | 冲突解决 | 进度合并策略 | P1 | 智能合并与手动确认 |
| F-04 | 异常检测 | 进度回滚保护 | P2 | 防止误触导致进度丢失 |
| F-05 | 书籍管理 | 书籍上传/下载/删除 | P1 | 支持 EPUB/TXT 格式，云端存储 |

### 3.2 详细功能说明
#### 3.2.1 阅读进度同步 (F-02)
- **前置条件**: 已连接服务端，且有网络连接。
- **交互流程**:
  1. 用户打开书籍。
  2. 系统后台请求云端最新进度。
  3. 若云端进度较新，自动跳转至对应章节/页码。
  4. 阅读过程中，每隔 30s 或翻页 10 次自动上传进度。
- **异常流程**:
  - 若无网络，将进度存入本地 SQLite，标记为 `dirty`。
  - 网络恢复后，自动上传所有 `dirty` 记录。
- **验收标准**:
  - 断网重连后，进度应能成功同步。
  - 多端切换阅读，延迟不超过 2s。

#### 3.2.2 冲突解决 (F-03)
- **策略**:
  - **Case A (时间差 > 1min)**: 自动采用最新时间戳的进度。
  - **Case B (时间差 < 1min)**: 弹窗提示用户：“检测到另一设备刚阅读过，是否跳转？”。

#### 3.2.3 书籍管理 (F-05)
- **功能**:
  - **上传**: 支持从本地导入 EPUB/TXT 文件，自动解析元数据（封面、作者、简介）并上传至云端。
  - **列表**: 展示云端书架，支持按时间排序。
  - **下载**: 点击云端书籍可下载至本地阅读。
  - **删除**: 长按书籍可删除本地或同时删除云端文件。

## 4. 非功能需求 (Non-Functional Requirements)
- **性能**: 页面加载 < 1s
- **安全**: API Key 必须安全存储 (Secure Storage)
- **兼容性**: 支持 iOS 14+, Android 10+

## 5. 数据埋点需求
| 事件ID | 事件名称 | 触发时机 | 属性 |
| :--- | :--- | :--- | :--- |
| e_read_start | 开始阅读 | 用户打开书籍 | book_id, chapter_id |
